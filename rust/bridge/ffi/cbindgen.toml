#
# Copyright (C) 2020-2021 Signal Messenger, LLC.
# SPDX-License-Identifier: AGPL-3.0-only
#

language = "C"

header = "/*\nCopyright (C) 2020-2021 Signal Messenger, LLC.\nSPDX-License-Identifier: AGPL-3.0-only\n*/\n"

include_guard = "SIGNAL_FFI_H_"

autogen_warning = "/* This file was automatically generated by cbindgen */"

style = "type"

[enum]
prefix_with_name = true

[export]
include = ["SignalErrorCode", "FfiDirection", "FfiCiphertextMessageType", "FfiContentHint", "RandomnessBytes"]
exclude = ["TAG_SIZE", "NONCE_SIZE"]
item_types = ["enums", "functions", "opaque", "structs", "typedefs", "constants"]
# FIXME: this doesn't work well with constants in SCREAMING_SNAKE_CASE
prefix = "Signal"
renaming_overrides_prefixing = true

[export.rename]
"FfiSessionStoreStruct" = "SignalSessionStore"
"FfiIdentityKeyStoreStruct" = "SignalIdentityKeyStore"
"FfiPreKeyStoreStruct" = "SignalPreKeyStore"
"FfiSignedPreKeyStoreStruct" = "SignalSignedPreKeyStore"
"FfiSenderKeyStoreStruct" = "SignalSenderKeyStore"
"FfiDirection" = "SignalDirection"
"FfiCiphertextMessageType" = "SignalCiphertextMessageType"
"FfiContentHint" = "SignalContentHint"

"BorrowedSliceOfc_uchar" = "SignalBorrowedBuffer"
"BorrowedMutableSliceOfc_uchar" = "SignalBorrowedMutableBuffer"

# Avoid double-prefixing these
"SignalFfiError" = "SignalFfiError"
"SignalErrorCode" = "SignalErrorCode"
"SignalMessage" = "SignalMessage"

[export.mangle]
remove_underscores = true

[fn]
sort_by = "None"

[parse]
parse_deps = true
include = ["libsignal-protocol", "signal-crypto", "zkgroup"]
extra_bindings = ["libsignal-bridge", "zkgroup"]

[parse.expand]
crates = ["libsignal-ffi", "libsignal-bridge"]
features = ["libsignal-bridge/ffi"]
